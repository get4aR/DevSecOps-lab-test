{% extends 'base.html' %}
{% block title %}Students — Pagination{% endblock %}

{% block content %}
<div style="display:flex; flex-direction:column; align-items:center; gap:16px; padding:20px 0;">

  <!-- Основная форма добавления/удаления -->
  <form method="post" action="{{ url_for('handle_form') }}" class="student-form" autocomplete="off">
    <h1>Добавить или удалить запись</h1>

    <input type="text" name="last_name" placeholder="Фамилия" value="">
    <input type="text" name="first_name" placeholder="Имя" value="">
    <input type="text" name="patronymic" placeholder="Отчество" value="">
    <input type="text" name="study_year" placeholder="Год обучения" value="">
    <input type="text" name="group_name" placeholder="Группа" value="">
    <input type="text" name="faculty_name" placeholder="Факультет" value="">

    <div class="div-btns" style="margin-top:10px;">
      <button class="btn-submit" type="submit" name="action" value="create">Submit</button>
      <button class="btn-delete" type="submit" name="action" value="delete">Delete</button>
    </div>
  </form>

  <!-- Таблица -->
  <table>
    <thead>
      <tr>
        <th>Фамилия</th>
        <th>Имя</th>
        <th>Отчество</th>
        <th>Год обучения</th>
        <th>Группа</th>
        <th>Факультет</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
        <tr>
          <td>{{ student.last_name }}</td>
          <td>{{ student.first_name }}</td>
          <td>{{ student.patronymic or '' }}</td>
          <td>{{ student.study_year or '' }}</td>
          <td>{{ student.group_name or '' }}</td>
          <td>{{ student.faculty_name or '' }}</td>
        </tr>
      {% else %}
        <tr>
          <td colspan="6">No students yet</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Панель пагинации -->
  <div class="pagination-controls" aria-label="Pagination controls">
    <!-- Левый блок: выбор размера страницы -->
    <div class="page-size-control">
      <label for="pageSize">Select page size:</label>

      <!-- GET-форма для смены размера (перенаправит на страницу 1 при смене) -->
      <form id="sizeForm" method="get" style="display:inline-block; margin-left:10px;">
        <input type="hidden" name="page" value="1">
        <select id="pageSize" name="size" onchange="this.form.submit()">
          <option value="10" {% if page_size == 10 %}selected{% endif %}>10 items per page</option>
          <option value="25" {% if page_size == 25 %}selected{% endif %}>25 items per page</option>
          <option value="50" {% if page_size == 50 %}selected{% endif %}>50 items per page</option>
        </select>
      </form>
    </div>

    <!-- Центральный блок: Previous | Go to page | Next -->
    <div class="page-input-control">
      <!-- Previous -->
      {% if current_page > 1 %}
        <a class="pagination-btn link-btn" href="?page={{ current_page - 1 }}&size={{ page_size }}" aria-label="Previous page">Previous</a>
      {% else %}
        <span class="pagination-btn disabled">Previous</span>
      {% endif %}

      <!-- Форма-переход на конкретную страницу -->
      <form method="get" class="inline-form" aria-label="Go to page form">
        <input type="hidden" name="size" value="{{ page_size }}">
        <label for="pageInput" style="margin:0 6px;">Go to page:</label>
        <input
          type="number"
          id="pageInput"
          name="page"
          value="{{ current_page }}"
          min="1"
          max="{{ total_pages }}"
          required
          style="width:64px;"
        />
        <button type="submit" class="small-btn">Go</button>
      </form>

      {% if current_page < total_pages %}
        <a class="pagination-btn link-btn" href="?page={{ current_page + 1 }}&size={{ page_size }}" aria-label="Next page">Next</a>
      {% else %}
        <span class="pagination-btn disabled">Next</span>
      {% endif %}
    </div>

    <!-- Cтатус -->
    <div class="pagination-status">
      <span>Page {{ current_page }} of {{ total_pages }}</span>
    </div>
  </div>
</div>
{% endblock %}
